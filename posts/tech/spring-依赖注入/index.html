<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<meta name="referrer" content="no-referrer-when-downgrade">
<title>依赖注入 | Mingyu&#39;s Blog</title>
<meta name="keywords" content="Spring, 学习笔记">
<meta name="description" content="
Spring 的学习笔记——依赖注入，本文代码存放在 github 仓库中
">
<meta name="author" content="
作者:&nbsp;Mingyu">
<link rel="canonical" href="http://www.lmingyu.tech/posts/tech/spring-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.37b5edb6a132c0f8f362e02faf302b5a609ac52173812dfff4069e59b08cf5d7.css" integrity="sha256-N7XttqEywPjzYuAvrzArWmCaxSFzgS3/9AaeWbCM9dc=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://www.lmingyu.tech/img/top.webp">
<link rel="icon" type="image/png" sizes="16x16" href="http://www.lmingyu.tech/img/top.webp">
<link rel="icon" type="image/png" sizes="32x32" href="http://www.lmingyu.tech/img/top.webp">
<link rel="apple-touch-icon" href="http://www.lmingyu.tech/Q.gif">
<link rel="mask-icon" href="http://www.lmingyu.tech/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="依赖注入" />
<meta property="og:description" content="
Spring 的学习笔记——依赖注入，本文代码存放在 github 仓库中
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.lmingyu.tech/posts/tech/spring-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" />
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/lmingyul/lmingyul.github.io@uPic/uPic/依赖注入-2022-10-16-233745.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-16T21:28:14&#43;08:00" />
<meta property="article:modified_time" content="2022-10-16T21:28:14&#43;08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/lmingyul/lmingyul.github.io@uPic/uPic/依赖注入-2022-10-16-233745.png" />
<meta name="twitter:title" content="依赖注入"/>
<meta name="twitter:description" content="
Spring 的学习笔记——依赖注入，本文代码存放在 github 仓库中
"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📚文章",
      "item": "http://www.lmingyu.tech/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "💻 技术",
      "item": "http://www.lmingyu.tech/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "依赖注入",
      "item": "http://www.lmingyu.tech/posts/tech/spring-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "依赖注入",
  "name": "依赖注入",
  "description": " Spring 的学习笔记——依赖注入，本文代码存放在 github 仓库中\n",
  "keywords": [
    "Spring", "学习笔记"
  ],
  "articleBody": " Spring 的学习笔记——依赖注入，本文代码存放在 github 仓库中\n什么是依赖注入 什么是依赖？ 在我们 Java 编程过程当中，总会有遇到 A 类对象实例需要调用 B 类对象方法的情形（除非你一个类走天下，否则总会遇到这种情况的），这种情况被 Spring 称为依赖，A 对象要用到 B 对象，即 A 对象依赖 B 对象，这种关系被称为依赖关系\n现在知道什么是依赖，那依赖注入是什么呢\n先看一下依赖的情况，我们是怎么处理的\n一般做法 当某个 Java 对象（调用者）调用另一个 Java 对象（被调用者）的方法时，一般的做法是调用者主动创建被调用者，然后再调用被调用者的方法\n我们创建两个类来模拟游戏，一个人 Person 类，一个 武器：剑 Sword 类\npackage com.mingyu.javalearn; /** * 剑 * @author liangtaiming * @date 2022/10/16 **/ public class Sword { /** * 攻击力 */ private String firePower; /** * 空参构造 */ public Sword() { } /** * 有参构造 */ public Sword(String firePower) { this.firePower = firePower; } /** * 攻击敌人方法 */ public void attackEnemy(String enemyName) { System.out.println(\"Sword can damage enemy \" + enemyName + \" \" + this.firePower + \" life\"); } } /** * 人 * @author liangtaiming */ @AllArgsConstructor @Data public class Person { public void attack(String enemy){ Sword sword = new Sword(\"50\"); sword.attackEnemy(enemy); } } 测试类\npublic class Test { public static void main(String[] args) { Person mingyu = new Person(); mingyu.attack(\"jack\"); } } 输出结果：\nSword can damage enemy jack 50 life 这种方法是我们最常用解决对象间依赖的方法，人 Person 类需要 new Sword()创建出武器对象，再调用武器对象的attackEnemy() 方法\n这样的做法虽然简单，但也有不足的地方：\n扩展性差：如果后期需要换武器，不用剑了换成使用其他武器，就需要对人 Person 这个类的代码进行修改，这样会导致人这个调用这个与被依赖对象剑产生了硬编码耦合，这样不利于代码的维护与改造。 对象间职责不明确：对于人 Person 对象来说，它只关心调用武器的攻击方法，并不关心武器的制作过程，但在这种一般模式下，人就直接参与到武器的制作，导致职责不明确 简单工厂方法 调用者先找到能创建被依赖的对象的工厂，然后主动通过工厂去获取被依赖的对象，最后再调用被依赖对象的方法\n可以看一下下面这个例子\n/** * 武器接口 * @author liangtaiming * @date 2022/10/16 **/ public interface Weapon { /** * 攻击敌人方法 * @param enemyName 敌人名称 */ public void attackEnemy(String enemyName); } /** * 剑 * @author liangtaiming * @date 2022/10/16 **/ public class Sword implements Weapon { /** * 攻击力 */ private String firePower; /** * 空参构造 */ public Sword() { } /** * 有参构造 */ public Sword(String firePower) { this.firePower = firePower; } /** * 攻击敌人方法 */ @Override public void attackEnemy(String enemyName) { System.out.println(\"Sword can damage enemy \" + enemyName + \" \" + this.firePower + \" life\"); } } /** * 枪 * @author liangtaiming * @date 2022/10/17 **/ public class Gun implements Weapon { /** * 攻击力 */ private String firePower; /** * 无参构造 */ public Gun() { } /** * 有参构造 */ public Gun(String firePower) { this.firePower = firePower; } @Override public void attackEnemy(String enemyName) { System.out.println(\"Gun can damage enemy \" + enemyName + \" \" + this.firePower + \" life\"); } } 再创建一个工厂类WeaponFactory，根据调用者不同的要求，创建出不同的武器对象并返回。而如果碰到不合法的要求，会返回一个Runtime异常\n/** * 武器工厂类 * * @author liangtaiming * @date 2022/10/17 **/ public class WeaponFactory { public static Weapon createWeapon(String type) { if (\"small\".equals(type)) { return new Sword(\"50\"); } else if (\"big\".equals(type)) { return new Gun(\"1000\"); } else { throw new RuntimeException(\"无法创建合适的武器类型\"); } } } /** * 人 * @author liangtaiming */ @AllArgsConstructor @Data public class Person { public void attack(String enemy){ // 通过调用工厂类 WeaponFactory 创建出不同的武器类，并调用不同武器的方法 Weapon weapon = WeaponFactory.createWeapon(enemy); weapon.attackEnemy(enemy); } } 测试类\n/** * @author liangtaiming * @date 2022/10/09 **/ public class Test { public static void main(String[] args) { String enemyType1 = \"big\"; String enemyType2 = \"small\"; Person person = new Person(); person.attack(enemyType1); person.attack(enemyType2); } } 输出结果\nGun can damage enemy big 1000 life Sword can damage enemy small 50 life 可以看出引入简单工厂模式后，会创建一个工厂类，有了这个工厂类之后，具体的武器 Sword 、Gun 类与人 Person 类不再耦合，人需要使用武器的时候不是亲自去创造一个武器，而是通过找工厂，让工厂帮你创造一把武器。\n这样做的好处是：改变武器就不需要修改 Person 类的代码，避免了这两种类之间的硬编码耦合\n不好的地方是：\n额外维护了一个工厂类，增加代码复杂度 虽然解决了调用者与被依赖对象耦合的问题，但工厂类与调用者却耦合在一起，而且当有复杂的多层次等级结构时，所有的业务逻辑都在这个工厂类中实现，当这个工厂类不能工作了，整个系统都会受到影响。 依赖注入 既然这两种解决依赖的方式都不太好，那 Spring 是怎么处理依赖的呢？\nSpring 框架有两个核心功能：\n可以把 Spring 当成一个大工厂（有人称为 Spring 容器），复制创建和管理所有的 Java 对象，这些 Java 对象被称为 Java Bean Spring 这个大工厂使用依赖注入的方式管理着容器中 Bean 之间的依赖关系 使用 Spring 之后，调用者不用主动去创建被依赖对象，只需要被动接受 Spring 容器给你这个对象就行了，从以前的主动获取到被动接受，即将制造武器的控制权从调用方交给了第三方，这种方式被称为“控制反转 IOC（Inverse of Control）”\n但是这个控制反转的说明不够形象，于是有了另一种解读的角度，就是依赖注入 DI (Dependency Injection)\n依赖注入，简单来说就是 Spring 将被依赖对象注入给调用者，调用者不用主动获取被依赖对象，相当于给调用者注入它依赖的对象，这个解释就很简洁明了\n依赖注入让 Spring 容器中 Bean 以配置文件的方式组织在一起，不仅可以为 Bean 注入普通的属性值，还可以注入其他 Bean 的引用，调用者既无须创建被依赖对象，也无须主动定位工厂，与被依赖对象、工厂都进行了耦合，所有的 Bean 之间的依赖关系都交由 Spring 来管理，让调用者可以当一个甩手掌柜。\n那 Spring 以什么样的方式将 Bean 注入到调用者的呢？\n依赖注入的方式 构造函数注入 构造函数注入： 通过调用类的构造函数，将接口实现类通过构造函数的变量进行注入\n下面就开始展示如何使用 Spring 将依赖的对象注入到调用方\n版本依赖使用 maven ，使用 Spring 的版本为 5.3.22\n引入的依赖：\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ",
  "wordCount" : "4704",
  "inLanguage": "en",
  "image":"https://cdn.jsdelivr.net/gh/lmingyul/lmingyul.github.io@uPic/uPic/依赖注入-2022-10-16-233745.png","datePublished": "2022-10-16T21:28:14+08:00",
  "dateModified": "2022-10-16T21:28:14+08:00",
  "author":{
    "@type": "Person",
    "name": "Mingyu"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.lmingyu.tech/posts/tech/spring-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Mingyu's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://www.lmingyu.tech/img/top.webp"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://www.lmingyu.tech" accesskey="h" title="Mingyu&#39;s Blog (Alt + H)">Mingyu&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://www.lmingyu.tech/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="http://www.lmingyu.tech/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="http://www.lmingyu.tech/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="http://www.lmingyu.tech/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://www.lmingyu.tech/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="http://www.lmingyu.tech/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
    <header class="post-header">
        <div class="breadcrumbs"><a href="http://www.lmingyu.tech">Home</a>&nbsp;»&nbsp;<a href="http://www.lmingyu.tech/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://www.lmingyu.tech/posts/tech/">💻 技术</a></div>
        <h1 class="post-title">
            依赖注入
        </h1>
        <div class="post-meta">










创建:&nbsp;<span title='2022-10-16 21:28:14 +0800 +0800'>2022-10-16</span>&nbsp;|&nbsp;更新:&nbsp;2022-10-16&nbsp;|&nbsp;字数:&nbsp;4704&nbsp;字&nbsp;|&nbsp;阅读约耗时: 10&nbsp;分钟&nbsp;|&nbsp;
作者:&nbsp;Mingyu

|&nbsp;本文被浏览了&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次
        </div>
    </header> 
<figure class="entry-cover1"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/lmingyul/lmingyul.github.io@uPic/uPic/%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5-2022-10-16-233745.png" alt="">
        
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5" aria-label="什么是依赖注入">什么是依赖注入</a><ul>
                            
                    <li>
                        <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e4%be%9d%e8%b5%96" aria-label="什么是依赖？">什么是依赖？</a><ul>
                            
                    <li>
                        <a href="#%e4%b8%80%e8%88%ac%e5%81%9a%e6%b3%95" aria-label="一般做法">一般做法</a></li>
                    <li>
                        <a href="#%e7%ae%80%e5%8d%95%e5%b7%a5%e5%8e%82%e6%96%b9%e6%b3%95" aria-label="简单工厂方法">简单工厂方法</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5" aria-label="依赖注入">依赖注入</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%be%9d%e8%b5%96%e6%b3%a8%e5%85%a5%e7%9a%84%e6%96%b9%e5%bc%8f" aria-label="依赖注入的方式">依赖注入的方式</a><ul>
                            
                    <li>
                        <a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0%e6%b3%a8%e5%85%a5" aria-label="构造函数注入">构造函数注入</a></li>
                    <li>
                        <a href="#%e5%b1%9e%e6%80%a7%e6%b3%a8%e5%85%a5" aria-label="属性注入">属性注入</a></li>
                    <li>
                        <a href="#%e4%be%9d%e8%b5%96%e6%96%b9%e5%bc%8f%e7%9a%84%e9%80%89%e6%8b%a9" aria-label="依赖方式的选择">依赖方式的选择</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" aria-label="参考资料">参考资料</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
    <div class="post-content"><blockquote>
<p>Spring 的学习笔记——依赖注入，本文代码存放在 <a href="https://github.com/lmingyul/springlearn">github 仓库</a>中</p>
</blockquote>
<h1 id="什么是依赖注入">什么是依赖注入<a hidden class="anchor" aria-hidden="true" href="#什么是依赖注入">#</a></h1>
<h2 id="什么是依赖">什么是依赖？<a hidden class="anchor" aria-hidden="true" href="#什么是依赖">#</a></h2>
<p>在我们 Java 编程过程当中，总会有遇到 A 类对象实例需要调用 B 类对象方法的情形（除非你一个类走天下，否则总会遇到这种情况的），这种情况被 Spring 称为依赖，A 对象要用到 B 对象，即 A 对象依赖 B 对象，这种关系被称为依赖关系</p>
<p>现在知道什么是依赖，那依赖注入是什么呢</p>
<p>先看一下依赖的情况，我们是怎么处理的</p>
<h3 id="一般做法">一般做法<a hidden class="anchor" aria-hidden="true" href="#一般做法">#</a></h3>
<p>当某个 Java 对象（调用者）调用另一个 Java 对象（被调用者）的方法时，一般的做法是调用者主动创建被调用者，然后再调用被调用者的方法</p>
<p>我们创建两个类来模拟游戏，一个人 Person 类，一个 武器：剑 Sword 类</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">com.mingyu.javalearn</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 剑
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @date 2022/10/16
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Sword</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 攻击力
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">firePower</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 空参构造
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Sword</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 有参构造
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Sword</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">firePower</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">firePower</span> <span style="color:#000">=</span> <span style="color:#000">firePower</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 攻击敌人方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemyName</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;Sword can damage enemy &#34;</span> <span style="color:#000">+</span> <span style="color:#000">enemyName</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34; &#34;</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">firePower</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34; life&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 人
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Person</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attack</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemy</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Sword</span> <span style="color:#000">sword</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Sword</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;50&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">sword</span><span style="color:#000">.</span><span style="color:#836c28">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">enemy</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p><strong>测试类</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Test</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Person</span> <span style="color:#000">mingyu</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Person</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">mingyu</span><span style="color:#000">.</span><span style="color:#836c28">attack</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;jack&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p>输出结果：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Sword</span> <span style="color:#000">can</span> <span style="color:#000">damage</span> <span style="color:#000">enemy</span> <span style="color:#000">jack</span> <span style="color:#1c01ce">50</span> <span style="color:#000">life</span>
</span></span></code></pre></div><p>这种方法是我们最常用解决对象间依赖的方法，人 Person 类需要 <code>new Sword()</code>创建出武器对象，再调用武器对象的<code>attackEnemy()</code> 方法</p>
<p>这样的做法虽然简单，但也有不足的地方：</p>
<ul>
<li><strong>扩展性差</strong>：如果后期需要换武器，不用剑了换成使用其他武器，就需要对人 Person 这个类的代码进行修改，这样会导致人这个调用这个与被依赖对象剑产生了硬编码耦合，这样不利于代码的维护与改造。</li>
<li><strong>对象间职责不明确</strong>：对于人 Person 对象来说，它只关心调用武器的攻击方法，并不关心武器的制作过程，但在这种一般模式下，人就直接参与到武器的制作，导致职责不明确</li>
</ul>
<h3 id="简单工厂方法">简单工厂方法<a hidden class="anchor" aria-hidden="true" href="#简单工厂方法">#</a></h3>
<blockquote>
<p>调用者先找到能创建被依赖的对象的工厂，然后主动通过工厂去获取被依赖的对象，最后再调用被依赖对象的方法</p>
</blockquote>
<p>可以看一下下面这个例子</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 武器接口
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @date 2022/10/16
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">interface</span> <span style="color:#3f6e75">Weapon</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 攻击敌人方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * @param enemyName 敌人名称
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemyName</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 剑
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @date 2022/10/16
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Sword</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Weapon</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 攻击力
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">firePower</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 空参构造
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Sword</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 有参构造
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Sword</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">firePower</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">firePower</span> <span style="color:#000">=</span> <span style="color:#000">firePower</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 攻击敌人方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemyName</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;Sword can damage enemy &#34;</span> <span style="color:#000">+</span> <span style="color:#000">enemyName</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34; &#34;</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">firePower</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34; life&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 枪
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @date 2022/10/17
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Gun</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Weapon</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 攻击力
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">firePower</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 无参构造
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Gun</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 有参构造
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Gun</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">firePower</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">firePower</span> <span style="color:#000">=</span> <span style="color:#000">firePower</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemyName</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;Gun can damage enemy &#34;</span> <span style="color:#000">+</span> <span style="color:#000">enemyName</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34; &#34;</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">firePower</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34; life&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p>再创建一个工厂类<code>WeaponFactory</code>，根据调用者不同的要求，创建出不同的武器对象并返回。而如果碰到不合法的要求，会返回一个Runtime异常</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 武器工厂类
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> *
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @date 2022/10/17
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">WeaponFactory</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#000">Weapon</span> <span style="color:#000">createWeapon</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">type</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#c41a16">&#34;small&#34;</span><span style="color:#000">.</span><span style="color:#836c28">equals</span><span style="color:#000">(</span><span style="color:#000">type</span><span style="color:#000">))</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">Sword</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;50&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span> <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#c41a16">&#34;big&#34;</span><span style="color:#000">.</span><span style="color:#836c28">equals</span><span style="color:#000">(</span><span style="color:#000">type</span><span style="color:#000">))</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">Gun</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;1000&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span> <span style="color:#a90d91">else</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">RuntimeException</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;无法创建合适的武器类型&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 人
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Person</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>  	
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attack</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemy</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>     		<span style="color:#177500">// 通过调用工厂类 WeaponFactory 创建出不同的武器类，并调用不同武器的方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">Weapon</span> <span style="color:#000">weapon</span> <span style="color:#000">=</span> <span style="color:#000">WeaponFactory</span><span style="color:#000">.</span><span style="color:#836c28">createWeapon</span><span style="color:#000">(</span><span style="color:#000">enemy</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">weapon</span><span style="color:#000">.</span><span style="color:#836c28">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">enemy</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p>测试类</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @date 2022/10/09
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Test</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">String</span> <span style="color:#000">enemyType1</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#34;big&#34;</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">String</span> <span style="color:#000">enemyType2</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#34;small&#34;</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Person</span> <span style="color:#000">person</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Person</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">person</span><span style="color:#000">.</span><span style="color:#836c28">attack</span><span style="color:#000">(</span><span style="color:#000">enemyType1</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">person</span><span style="color:#000">.</span><span style="color:#836c28">attack</span><span style="color:#000">(</span><span style="color:#000">enemyType2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p>输出结果</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Gun</span> <span style="color:#000">can</span> <span style="color:#000">damage</span> <span style="color:#000">enemy</span> <span style="color:#000">big</span> <span style="color:#1c01ce">1000</span> <span style="color:#000">life</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Sword</span> <span style="color:#000">can</span> <span style="color:#000">damage</span> <span style="color:#000">enemy</span> <span style="color:#000">small</span> <span style="color:#1c01ce">50</span> <span style="color:#000">life</span>
</span></span></code></pre></div><p>可以看出引入简单工厂模式后，会创建一个工厂类，有了这个工厂类之后，具体的武器 Sword 、Gun 类与人 Person 类不再耦合，人需要使用武器的时候不是亲自去创造一个武器，而是通过找工厂，让工厂帮你创造一把武器。</p>
<p>这样做的好处是：改变武器就不需要修改 Person 类的代码，避免了这两种类之间的硬编码耦合</p>
<p>不好的地方是：</p>
<ul>
<li>额外维护了一个工厂类，增加代码复杂度</li>
<li>虽然解决了调用者与被依赖对象耦合的问题，但工厂类与调用者却耦合在一起，而且当有复杂的多层次等级结构时，所有的业务逻辑都在这个工厂类中实现，当这个工厂类不能工作了，整个系统都会受到影响。</li>
</ul>
<h2 id="依赖注入">依赖注入<a hidden class="anchor" aria-hidden="true" href="#依赖注入">#</a></h2>
<blockquote>
<p>既然这两种解决依赖的方式都不太好，那 Spring 是怎么处理依赖的呢？</p>
</blockquote>
<p>Spring 框架有两个核心功能：</p>
<ul>
<li>可以把 Spring 当成一个大工厂（有人称为 Spring 容器），复制创建和管理所有的 Java 对象，这些 Java 对象被称为 Java Bean</li>
<li>Spring 这个大工厂使用<strong>依赖注入</strong>的方式管理着容器中 Bean 之间的依赖关系</li>
</ul>
<p>使用 Spring 之后，调用者不用主动去创建被依赖对象，只需要被动接受 Spring 容器给你这个对象就行了，从以前的主动获取到被动接受，即将制造武器的控制权从调用方交给了第三方，这种方式被称为“<strong>控制反转 IOC（Inverse of Control）</strong>”</p>
<p>但是这个控制反转的说明不够形象，于是有了另一种解读的角度，就是依赖注入 <strong>DI (Dependency Injection)</strong></p>
<p>依赖注入，简单来说就是 Spring 将被依赖对象注入给调用者，调用者不用主动获取被依赖对象，相当于给调用者注入它依赖的对象，这个解释就很简洁明了</p>
<p>依赖注入让 Spring 容器中 Bean 以配置文件的方式组织在一起，不仅可以为 Bean 注入普通的属性值，还可以注入其他 Bean 的引用，调用者既无须创建被依赖对象，也无须主动定位工厂，与被依赖对象、工厂都进行了耦合，所有的 Bean 之间的依赖关系都交由 Spring 来管理，让调用者可以当一个甩手掌柜。</p>
<p>那 Spring 以什么样的方式将 Bean 注入到调用者的呢？</p>
<h1 id="依赖注入的方式">依赖注入的方式<a hidden class="anchor" aria-hidden="true" href="#依赖注入的方式">#</a></h1>
<h2 id="构造函数注入">构造函数注入<a hidden class="anchor" aria-hidden="true" href="#构造函数注入">#</a></h2>
<blockquote>
<p>构造函数注入： 通过调用类的构造函数，将接口实现类通过构造函数的变量进行注入</p>
</blockquote>
<p>下面就开始展示如何使用 Spring 将依赖的对象注入到调用方</p>
<p>版本依赖使用 maven ，使用 Spring 的版本为 5.3.22</p>
<p>引入的依赖：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#633820">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;project</span> <span style="color:#836c28">xmlns=</span><span style="color:#c41a16">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#836c28">xmlns:xsi=</span><span style="color:#c41a16">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#836c28">xsi:schemaLocation=</span><span style="color:#c41a16">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;groupId&gt;</span>com.mingyu<span style="color:#000">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;artifactId&gt;</span>spring_test<span style="color:#000">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#000">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;maven.compiler.source&gt;</span>8<span style="color:#000">&lt;/maven.compiler.source&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;maven.compiler.target&gt;</span>8<span style="color:#000">&lt;/maven.compiler.target&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;file.encoding&gt;</span>UTF-8<span style="color:#000">&lt;/file.encoding&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;spring.version&gt;</span>5.3.22<span style="color:#000">&lt;/spring.version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">&lt;!-- 依赖的 Spring 模块类库 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;groupId&gt;</span>org.springframework<span style="color:#000">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;artifactId&gt;</span>spring-core<span style="color:#000">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;version&gt;</span>${spring.version}<span style="color:#000">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;groupId&gt;</span>org.springframework<span style="color:#000">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;artifactId&gt;</span>spring-beans<span style="color:#000">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;version&gt;</span>${spring.version}<span style="color:#000">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;groupId&gt;</span>org.springframework<span style="color:#000">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;artifactId&gt;</span>spring-context<span style="color:#000">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;version&gt;</span>${spring.version}<span style="color:#000">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/project&gt;</span>
</span></span></code></pre></div><p>由于引入 Spring 框架，我们需要使用 Spring 特定的管理 Bean 对象的方法，使用配置文件的方式创建和管理 Bean，配置文件的名字一般为 <code>beans.xml</code>，放置在 <code>resources</code> 目录下</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#633820">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;beans</span> <span style="color:#836c28">xmlns=</span><span style="color:#c41a16">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#836c28">xmlns:xsi=</span><span style="color:#c41a16">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#836c28">xsi:schemaLocation=</span><span style="color:#c41a16">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">&lt;!-- 配置 person 实例，其实现类是 Person --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;bean</span> <span style="color:#836c28">id=</span><span style="color:#c41a16">&#34;person&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Person&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">&lt;!-- 下面只有一个 constructor-arg 子元素，
</span></span></span><span style="display:flex;"><span><span style="color:#177500">            驱动 Spring 调用 Person 带一个参数的构造器来创建对象 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;constructor-arg</span> <span style="color:#836c28">ref=</span><span style="color:#c41a16">&#34;sword&#34;</span> <span style="color:#836c28">type=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Weapon&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">&lt;!-- 配置 sword 实例，其实现类是 Sword --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;bean</span> <span style="color:#836c28">id=</span><span style="color:#c41a16">&#34;sword&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Sword&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;constructor-arg</span> <span style="color:#836c28">index=</span><span style="color:#c41a16">&#34;0&#34;</span> <span style="color:#836c28">value=</span><span style="color:#c41a16">&#34;50&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">&lt;!-- 配置 gun 实例，其实现类是 Gun --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;bean</span> <span style="color:#836c28">id=</span><span style="color:#c41a16">&#34;gun&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Gun&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;constructor-arg</span> <span style="color:#836c28">index=</span><span style="color:#c41a16">&#34;0&#34;</span> <span style="color:#836c28">value=</span><span style="color:#c41a16">&#34;1000&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/beans&gt;</span>
</span></span></code></pre></div><p>人 Person 类跟上面的不一样</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 人
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Person</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">Weapon</span> <span style="color:#000">weapon</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 构造注入所需的带参数的构造器
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * @param weapon 被注入的对象
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Person</span><span style="color:#000">(</span><span style="color:#000">Weapon</span> <span style="color:#000">weapon</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">weapon</span> <span style="color:#000">=</span> <span style="color:#000">weapon</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attack</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemy</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 调用依赖对象 weapon 的 attackEnemy(）方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">weapon</span><span style="color:#000">.</span><span style="color:#836c28">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">enemy</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p><code>Sword</code> 类、 <code>Gun</code> 类  和 <code>Weapon</code> 类维持不变</p>
<p><strong>测试类</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @date 2022/10/09
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Test</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 创建Spring容器
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#000">ClassPathXmlApplicationContext</span> <span style="color:#000">ctx</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ClassPathXmlApplicationContext</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;beans.xml&#34;</span><span style="color:#000">)){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 获取person实例
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#000">Person</span> <span style="color:#000">person</span> <span style="color:#000">=</span> <span style="color:#000">ctx</span><span style="color:#000">.</span><span style="color:#836c28">getBean</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;person&#34;</span><span style="color:#000">,</span> <span style="color:#000">Person</span><span style="color:#000">.</span><span style="color:#836c28">class</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 调用attack()方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#000">person</span><span style="color:#000">.</span><span style="color:#836c28">attack</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;Boss&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p><strong>输出结果</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Sword</span> <span style="color:#000">can</span> <span style="color:#000">damage</span> <span style="color:#000">enemy</span> <span style="color:#000">Boss</span> <span style="color:#1c01ce">50</span> <span style="color:#000">life</span>
</span></span></code></pre></div><p>可以观察到我们调用 person 对象的 <code>attack()</code> 方法中实际调用的是依赖对象 weapon 的 <code>attackEnemy(）</code>方法，但从输出结果可以看出最终调用的却是 sword 对象的 <code>attackEnemy()</code> 方法，那到底是哪里导致我引用的是 weapon 对象，出现的却是 sword 对象</p>
<p>从新引入的 <code>beans.xml</code> 文件可以看到有这些配置</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">&lt;</span><span style="color:#000">bean</span> <span style="color:#000">id</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;person&#34;</span> <span style="color:#000">class</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Person&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;</span><span style="color:#000">constructor</span><span style="color:#000">-</span><span style="color:#000">arg</span> <span style="color:#000">ref</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;sword&#34;</span> <span style="color:#000">type</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Weapon&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/</span><span style="color:#000">bean</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;</span><span style="color:#000">bean</span> <span style="color:#000">id</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;sword&#34;</span> <span style="color:#000">class</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Sword&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">&lt;</span><span style="color:#000">constructor</span><span style="color:#000">-</span><span style="color:#000">arg</span> <span style="color:#000">index</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;0&#34;</span> <span style="color:#000">value</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;50&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/</span><span style="color:#000">bean</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;</span><span style="color:#000">bean</span> <span style="color:#000">id</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;gun&#34;</span> <span style="color:#000">class</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Gun&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#000">&lt;</span><span style="color:#000">constructor</span><span style="color:#000">-</span><span style="color:#000">arg</span> <span style="color:#000">index</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;0&#34;</span> <span style="color:#000">value</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;1000&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/</span><span style="color:#000">bean</span><span style="color:#000">&gt;</span>
</span></span></code></pre></div><ul>
<li><code>&lt;bean.../&gt;</code> 这个元素代表一个 Java Bean 对象
<ul>
<li><code>&lt;bean../&gt;</code> 中 <strong>id</strong> 在整个容器中是这个对象的唯一身份标识，不能与其他对象重复，Spring 通过 id属性来管理 Bean</li>
<li><code>&lt;bean../&gt;</code> 中 class 代表是由哪个类生成的对象实例，使用全类路径进行填写，Spring 会使用 XML 解析器读取并利用反射来创建类实例</li>
</ul>
</li>
<li>在 <code>&lt;bean.../&gt;</code> 中有这么一个 <code>&lt;constructor-arg../&gt;</code> 子元素，每一个 <code>&lt;constructor-arg../&gt;</code> 元素代表一个构造器参数， Spring 就是根据这个子元素调用父元素对象的有参构造函数进行创建对象
<ul>
<li>如果没有声明  <code>&lt;constructor-arg../&gt;</code>  子元素，就是默认驱动 Spring 调用无参构造器类创建对象</li>
<li>如果有 N 个  <code>&lt;constructor-arg../&gt;</code>  子元素，Spring 就会调用带 N 个参数的构造器去创建对象</li>
<li>Index 属性用于定义构造函数中参数的位置，从下标为 0 开始</li>
<li>value 属性则是入参的值</li>
</ul>
</li>
</ul>
<p><code>&lt;construct-rg&gt;</code>中有不少属性是可以进行配置的</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>传给构造方法参数的值</td>
</tr>
<tr>
<td>ref</td>
<td>传给构造方法参数的 Bean ID</td>
</tr>
<tr>
<td>type</td>
<td>构造方法参数对象的类型</td>
</tr>
<tr>
<td>index</td>
<td>构造方法参数对应的位置，从 0 开始计算</td>
</tr>
<tr>
<td>name</td>
<td>构造方法参数对应的名称</td>
</tr>
</tbody>
</table>
<p>在<code>&lt;constructor-arg../&gt;</code> 元素中可以看到，它指定了构造器参数的类型为<code>com.mingyu.javalearn.Weapon</code>，通过 type 属性进行指定的，这代表的是 Person 类的对象 person 通过有参构造器注入 Weapon 类的对象，从这里对象间的依赖关系就确定了</p>
<p>Weapon 是一个接口，接口不能直接使用，那具体使用的是哪个类的对象进行注入呢</p>
<p>其实 Spring 有 2 种匹配入参的方法：</p>
<ul>
<li>根据类型匹配入参—— 通过 <code>ref</code> 和 <code>type</code> 这2个属性匹配</li>
<li>根据索引匹配入参—— 通过 <code>index</code> 和 <code>value</code> 这2个属性匹配</li>
</ul>
<p>通过 <code>ref</code> 这个属性进行再一步的指定，这里指定的 sword ，然后 Spring 就会通过 sword 找到 <code>id</code> 为 sword 的 Java Bean 对象（<code>id</code> 是唯一的，所以是通过找 id 确定的 Bean）进行对 person 对象的依赖注入</p>
<p>最后注入到 person 对象中的对象就是<code>com.mingyu.javalearn.Sword</code> 的对象，所以最后输出的结果才是<code>Sword can damage enemy Boss 50 life</code></p>
<p>如果我们将<code>&lt;constructor-arg../&gt;</code> 中的 <code>ref</code> 属性改为 gun ，输出的结果就会变为：<code>Gun can damage enemy Boss 1000 life</code></p>
<p>那将<code>ref</code> 属性随便改可以吗，改成 test 之类的？</p>
<ul>
<li>答案是不行的，因为 Spring 找不到 id  为 test 的 <code>&lt;bean../&gt;</code> 元素，找不到就会报错<code>Cannot resolve bean 'test'</code></li>
</ul>
<p>那如果我把 Test 类创建出来，并在 <code>beans.xml</code> 中配置了 test 这个 bean ，再把<code>ref</code> 属性改为 test 能成功吗</p>
<ul>
<li>答案也是不行的，虽然会帮你找到 id  为 test 的 <code>&lt;bean../&gt;</code> 元素，但是这个 Test 类并没有对 Weapon 接口进行实现，即与 Weapon 接口没有任何关系，强行写 test 就会报<code>Bean must be of 'com.mingyu.javalearn.Weapon' type </code>这个错误</li>
</ul>
<p>到这里我们知道了 Spring 怎么管理对象之间的依赖关系的，也了解了一点 Bean 的定义以及配置，那到底 Spring 是怎么进行依赖注入的呢？</p>
<p>下面用一段伪代码说明一下 Spring 具体做了一些什么事情</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">String</span> <span style="color:#000">id</span> <span style="color:#000">=</span> <span style="color:#000">person</span>  <span style="color:#177500">// Spring 解析&lt;bean../&gt;元素得到id属性为person
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">String</span> <span style="color:#000">ref</span> <span style="color:#000">=</span> <span style="color:#000">sword</span> <span style="color:#177500">// Spring 解析&lt;constructor-arg../&gt;元素得到ref属性为sword
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>  
</span></span><span style="display:flex;"><span><span style="color:#177500">//  container 代表 Spring 容器
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">Object</span> <span style="color:#000">paramBean</span> <span style="color:#000">=</span> <span style="color:#000">container</span><span style="color:#000">.</span><span style="color:#836c28">get</span><span style="color:#000">(</span><span style="color:#000">ref</span><span style="color:#000">);</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// 通过 person 对象的构造函数对 ref 这个 Bean 进行注入
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">Object</span> <span style="color:#000">obj</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">com</span><span style="color:#000">.</span><span style="color:#836c28">mingyu</span><span style="color:#000">.</span><span style="color:#836c28">javalearn</span><span style="color:#000">.</span><span style="color:#836c28">Person</span><span style="color:#000">(</span><span style="color:#000">paramBean</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// 最后将 person 这个 Bean 以及这个 Bean 所依赖的关系都会存储在 Spring 容器中
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">container</span><span style="color:#000">.</span><span style="color:#836c28">put</span><span style="color:#000">(</span><span style="color:#000">id</span><span style="color:#000">,</span> <span style="color:#000">obj</span><span style="color:#000">);</span>
</span></span></code></pre></div><p>由于使用了有参构造器创建 Person 实例，所以当 Person 实例对象被创建完成之际，该 Bean 的依赖关系已经设置完成</p>
<h2 id="属性注入">属性注入<a hidden class="anchor" aria-hidden="true" href="#属性注入">#</a></h2>
<p>使用构造函数进行注入，虽然依赖关系更加直观（我要依赖哪个对象在创建对象的时候就声明好了），但这种方法也有局限的地方</p>
<ul>
<li>如果 A 对象依赖的对象不仅只有 B 对象，还包括其他很多对象，这个时候再采用构造器进行注入就会将对象的构造函数变得很臃肿（构造器 0含有很多入参）</li>
<li>而且 A 对象在某些行为中并不一定都需要依赖所有对象，比如：人在攻击行为中会用到武器这种对象，但在吃饭行为中并不需要武器，需要的却是筷子🥢，所以如果在人构造初始化的时就把武器对象进行注入，就显得不合适，正确的做法应该是哪里需要，注入哪里</li>
</ul>
<p>这个时候就需要采用属性注入的方法了。属性注入指的是通过 <code>setXxx()</code> 方法注入 Bean 的属性值或依赖对象，属性注入是最常用的注入方式。</p>
<p>这时需要修改这两个文件 <code>Person.java</code> 和 <code>beans.xml</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * 人
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * @author liangtaiming
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Person</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">Weapon</span> <span style="color:#000">weapon</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 属性注入的setter方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * @param weapon 注入的对象
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">setWeapon</span><span style="color:#000">(</span><span style="color:#000">Weapon</span> <span style="color:#000">weapon</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">weapon</span> <span style="color:#000">=</span> <span style="color:#000">weapon</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">attack</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">enemy</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 调用依赖对象 weapon 的 attackEnemy(）方法
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">weapon</span><span style="color:#000">.</span><span style="color:#836c28">attackEnemy</span><span style="color:#000">(</span><span style="color:#000">enemy</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#633820">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;beans</span> <span style="color:#836c28">xmlns=</span><span style="color:#c41a16">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#836c28">xmlns:xsi=</span><span style="color:#c41a16">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#836c28">xsi:schemaLocation=</span><span style="color:#c41a16">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">&lt;!-- 配置 person 实例，其实现类是 Person --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;bean</span> <span style="color:#836c28">id=</span><span style="color:#c41a16">&#34;person&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Person&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">&lt;!-- 下面只有一个 constructor-arg 子元素，
</span></span></span><span style="display:flex;"><span><span style="color:#177500">            驱动 Spring 调用 Person 带一个参数的构造器来创建对象 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;property</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;weapon&#34;</span> <span style="color:#836c28">ref=</span><span style="color:#c41a16">&#34;sword&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">&lt;!-- 配置 sword 实例，其实现类是 Sword --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;bean</span> <span style="color:#836c28">id=</span><span style="color:#c41a16">&#34;sword&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Sword&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">&lt;!-- 配置 gun 实例，其实现类是 Gun --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;bean</span> <span style="color:#836c28">id=</span><span style="color:#c41a16">&#34;gun&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;com.mingyu.javalearn.Gun&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/beans&gt;</span>
</span></span></code></pre></div><p>仔细观察可以发现 Person 类中将构造函数修改为 <code>setXxx()</code>方法。在属性注入当中，Spring 会先调用 Bean 的默认构造函数实例化 Bean 对象，然后通过反射的方法调用 Setter 方法注入属性值。这里的 Person 类一看并没有默认的构造方法，其实如果我们没有显式定义构造函数 ，JVM会自动生成一个默认构造函数的。</p>
<p>而 beans.xml 中将 <code>&lt;constructor-arg../&gt;</code> 元素改为 <code>&lt;property../&gt;</code> 元素，而 name 属性指的是 Person 类中需要被注入的属性值</p>
<p>这次 Spring 就会根据<code>&lt;property../&gt;</code> 元素调用对应的 setter 方法为 Bean 的成员变量注入依赖的类对象实例</p>
<h2 id="依赖方式的选择">依赖方式的选择<a hidden class="anchor" aria-hidden="true" href="#依赖方式的选择">#</a></h2>
<ul>
<li>构造函数注入的优点：
<ul>
<li>构造函数注入可以保证 Bean 一些重要的属性在 Bean 实例化时就准备好</li>
<li>不需要为每个属性提供 Setter 方法，减少类的方法个数</li>
</ul>
</li>
<li>属性注入的优点：
<ul>
<li>更适用于类属性多的情况</li>
<li>更利于类的继承与扩展，因为子类不需要引用父类复杂的构造方法</li>
<li>避免循环依赖的问题</li>
</ul>
</li>
</ul>
<p>Spring 并不强制使用哪一种方法，一般建议采用以属性注入为主，构造依赖注入为辅，对于依赖关系没有变化的注入，尽量采用构造器注入，其他的则采用属性注入</p>
<hr>
<h1 id="参考资料">参考资料<a hidden class="anchor" aria-hidden="true" href="#参考资料">#</a></h1>
<ul>
<li><!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>作者：" + data.author + " / 出版："+ data.pubdate +" / "+ data.publisher +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/35028233/" urlstring="https://book.douban.com/subject/35028233/" class="douban_item post-preview"></div>
</div>
</body>
</html></li>
<li><!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <style>
        .post-preview {
            max-width: 780px;
            height: 200px;
            margin: 1em auto;
            position: relative;
            display: flex;
             
            background: var(--entry);
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .25), 0 0 2px rgba(0, 0, 0, .25);
        }

        .dark .post-preview {
             
            background: var(--entry);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .5), 0 0 2px rgba(0, 0, 0, .5);
        }

        .post-preview--meta {
            width: 80%;
            padding: 23px;
            overflow: hidden;
        }

        .post-preview--middle {
            line-height: 28px;
        }

        .post-preview--title {
            font-size: 22px;
            margin: 0 !important;
        }

        .post-preview--title a {
            text-decoration: none;
        }

        .post-preview--date {
            font-size: 14px;
            color: #999;
        }

        .post-preview--excerpt {
            font-size: 14px;
            line-height: 1.825;
        }

        .post-preview--excerpt p {
            display: inline;
            margin: 0;
        }

        .post-preview--image {
            height: 200px !important;
            width: 25%;
            float: right;
            border-radius: 0 15px 15px 0;
        }

        .post-preview img {
            margin: unset;
            width: 20%;
            border-radius: 0 15px 15px 0;
        }

        @media (max-width: 550px) {
            .post-preview {
                width: 95%;
            }

            .post-preview--excerpt {
                display: none;
            }

            .post-preview--middle {
                line-height: 19px;
            }
        }

        .rating {
            display: block;
            line-height: 15px;
        }

        .rating-star {
            display: inline-block;
            width: 75px;
            height: 15px;
            background-repeat: no-repeat;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAClCAYAAAAUAAAYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA5xJREFUeNrs3T9rFEEcxvG7qEQIglaCICKkin9AUEtBKxU7wS61VlYivgWj70TtNFj5BqzE7qxEWwsxKIoYn4UtluFmbm8nczvzm+/BjxyuDwNzu3uXD0+46f7LC5PA45Hm+WTYw1x2LRDc0jzTXB+wqMlsaLPutz8fDFjYZHYauAz3NBvt83XNnyUWNpn1nVm3OsHmsb3EomazzZnVXKMPNcc0xzUnNKc0Rzv/77fms+Z7O3vt9b1eU7bZrNN68l5zcolX4ofmsuZXTdnmMvyi2dR86Bmcac62P6vKrnVubpc0bxYE32nOab45N8YqsvPeDfcD4SOav4HjprPuu+H5BTt9LXDMfNbdLPfT678Fx6vKupt1o/O8+R3pkOaJ5/iktqx7z/qp+aq5q/nY+fczmheaK03Gs7D5rLtZdzSvA6/Ebc2u55j57HQB0TzW7AzkjiKzny6+2hlKNE8juMNcFqKBaIZndRlCNBBNgmx7ZkE0fbLtZkE0EA1EM17WuQwhGogGooFoss6296y52cNO+J6HLJoPaFdbsvA9zGerIxrPh85eWYgGooFoDiQbuAxp0UA0EVmdWbRo+ma1WbRoIBqIZtzsnHdDWjQQDUQD0WSbde5ZS2UhmtqJJtSEiVkXooFoIJre2VATJmZdiKZ2ogk1YSb8oVMvDeUPnSAaiCaPJkzMuhANRAPRQDQpsqEmTMy6EI11oolpwkA0EA1EcyDZmCYMRAPR+LMxTZjqiCamCQPRQDQQzehNGIgGooFoIJpVZ2OaMBBN7USTqgkD0UA0EE3vbKomDERTO9GkasKYJJpUTRiIBqKBaEZvwkA0EA1EA9GkyKZqwkA01olmrCYMRAPRQDR9LkO+0QmiKbAJUyTRjNWEgWggGohm9CYMRAPRQDQQzZDsWE0YiMYC0eTYhIFoIJrKiCbHJgxEY4FocmzCZEs0OTZhIBqIpjKiybEJA9FANBANROPL5tiEgWhKIJoSmzAQDURjjGhKbMJANCUQTYlNmNGIpsQmDEQD0RgjmhKbMBANRAPR1Es0JTZhIJpciMZaEwaigWgKJBprTRiIJheisdaESUo01powEA1EUyDRWGvCQDQQDURjm2isNWEgmlURzWw2q4pZIBqIJkOiCVyGJpkFolkV0ejMMvel28mIRptl7ku3IRqIpjCimfNuaJpZIBqIBqIpm2ice5Z5ZonJupvVkMRu4JW4qXnrOWY++1+AAQBw9BJSCTeN9wAAAABJRU5ErkJggg==);
            overflow: hidden;
        }

        .allstar10 {
            background-position: 0px 0px;
        }

        .allstar9 {
            background-position: 0px -15px;
        }

        .allstar8 {
            background-position: 0px -30px;
        }

        .allstar7 {
            background-position: 0px -45px;
        }

        .allstar6 {
            background-position: 0px -60px;
        }

        .allstar5 {
            background-position: 0px -75px;
        }

        .allstar4 {
            background-position: 0px -90px;
        }

        .allstar3 {
            background-position: 0px -105px;
        }

        .allstar2 {
            background-position: 0px -120px;
        }

        .allstar1 {
            background-position: 0px -135px;
        }

        .allstar0 {
            background-position: 0px -150px;
        }


        .rating-average {
            color: #777;
            display: inline-block;
            font-size: 13px;
            margin-left: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.douban_item').each(function () {
                var _this = $(this);
                var strs = _this.attr('urlstring').toString();
                var db_reg = /^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/;
                if (db_reg.test(strs)) {
                    var db_type = strs.replace(db_reg, "$1");
                    var db_id = strs.replace(db_reg, "$2").toString();
                    var db_api = "https://douban.edui.fun/";
                    if (db_type === 'movie') {
                        var ls_item = 'movie' + db_id;
                        var url = db_api + "movies/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: "json", success: function (data) {
                                    localStorage.setItem(ls_item, JSON.stringify(data));
                                    movieShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            movieShow(_this, ls_item, strs)
                        }
                    } else if (db_type === 'book') {
                        var ls_item = 'book' + db_id;
                        var url = db_api + "v2/book/id/" + db_id;
                        if (localStorage.getItem(ls_item) == null || localStorage.getItem(ls_item) === 'undefined') {
                            $.ajax({
                                url: url, type: 'GET', dataType: 'json', success: function (data) {
                                    localStorage.setItem('book' + db_id, JSON.stringify(data));
                                    bookShow(_this, ls_item, strs)
                                }
                            })
                        } else {
                            bookShow(_this, ls_item, strs)
                        }
                    }
                }
            });
        });

        function movieShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.name + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating + "</div></div><time class='post-preview--date'>导演：" + data.director + " / 类型：" + data.genre + " / " + data.year + "</time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.intro.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.img + "></div>").replaceAll(_this)
        }

        function bookShow(_this, ls_item, str) {
            var storage = localStorage.getItem(ls_item);
            var data = JSON.parse(storage);
            var db_star = Math.ceil(data.rating.average);
            $("<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><div class='post-preview--title'><a target='_blank' style='box-shadow: none; font-weight: bolder;' href='" + str + "'>" + data.title + "</a></div><div class='rating'><div class='rating-star allstar" + db_star + "'></div><div class='rating-average'>" + data.rating.average + "</div></div><time class='post-preview--date'>作者：" + data.author + " / 出版："+ data.pubdate +" / "+ data.publisher +" </time><section style='max-height:75px;overflow:hidden;' class='post-preview--excerpt'>" + data.summary.replace(/\s*/g, "") + "</section></div></div><img referrerpolicy='no-referrer' loading='lazy' class='post-preview--image' src=" + data.images.medium + "></div>").replaceAll(_this)
        }
    </script>
</head>
<body>
<div class="douban_show">
    <div id="dbhttps://book.douban.com/subject/26952826/" urlstring="https://book.douban.com/subject/26952826/" class="douban_item post-preview"></div>
</div>
</body>
</html></li>
</ul>

    </div>

    <footer class="post-footer">
        <ul class="post-tags">
            <li><a href="http://www.lmingyu.tech/tags/spring/">Spring</a></li>
            <li><a href="http://www.lmingyu.tech/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li>
        </ul>
<nav class="paginav">
  <a class="prev" href="http://www.lmingyu.tech/posts/input/%E4%BD%A0%E6%98%AF%E4%BD%A0%E5%90%83%E5%87%BA%E6%9D%A5%E7%9A%84%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">
    <span class="title">« Prev</span>
    <br>
    <span>《你是你吃出来的》读书笔记</span>
  </a>
  <a class="next" href="http://www.lmingyu.tech/posts/input/%E6%88%91%E6%98%AF%E4%B8%80%E5%8F%AAit%E5%B0%8F%E5%B0%8F%E9%B8%9F%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">
    <span class="title">Next »</span>
    <br>
    <span>《我是一只IT小小鸟》读书笔记</span>
  </a>
</nav>

    </footer><script src="https://utteranc.es/client.js"
        repo="lmingyul/lmingyul.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

</article>
    </main>
    
<footer class="footer">
    <span>Mingyu</span>
    <span>
        <a href="http://beian.miit.gov.cn" target="_blank" style="color: #939393">粤ICP备2022085443号</a>
    </span>
    <span id="busuanzi_container_site_pv">
        本站点击访问量：<span id="busuanzi_value_site_pv"></span>次，&nbsp;欢迎👏🏻！！！
        </span>




</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <img src="/img/rocket.webp" alt="top">




</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
            }
            ;
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
